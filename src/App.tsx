import React, { Suspense } from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { LanguageProvider } from './features/retirement/hooks/useLanguage';
import { AuthProvider } from './hooks/useAuth';
import Layout from './components/layout/Layout';

// Nouvelles pages principales
import Accueil from './pages/Accueil';
import Home from './pages/Home';
import MaRetraite from './pages/MaRetraite';
import Revenus from './pages/Revenus';
import PlanificationUrgence from './pages/PlanificationUrgence';
import PlanificationSuccessorale from './pages/PlanificationSuccessorale';
import PlanificationDepenses from './pages/PlanificationDepenses';
import AssistantFinancier from './pages/AssistantFinancier';
import Budget from './pages/Budget';

// Module MVP Hypoth√®ses de Calcul
import SimpleAssumptionsPage from './pages/SimpleAssumptionsPage';

// Blog pages
import BlogPage from './pages/BlogPage';
import OptimiserTransmissionCeli from './pages/blog/OptimiserTransmissionCeli';

// NOUVEAUX MODULES INT√âGR√âS
import { SRGAnalysisSection } from './features/retirement/components/SRGAnalysisSection';
import RREGOPAnalysisSection from './features/retirement/components/RREGOPAnalysisSection';
import { RealEstateOptimizationSection } from './features/retirement/components/RealEstateOptimizationSection';
import { TaxOptimizationDashboard } from './features/retirement/components/TaxOptimizationDashboard';
import { MonteCarloSimulator } from './features/retirement/components/MonteCarloSimulator';
import { SensitivityAnalysis } from './features/retirement/components/SensitivityAnalysis';
import { ScenarioComparison } from './features/retirement/components/ScenarioComparison';
import { UltimatePlanningDashboard } from './features/retirement/components/UltimatePlanningDashboard';
import ExpensesPage from './pages/ExpensesPage';
import RRQCPPAnalysis from './pages/RRQCPPAnalysis';
import ImmobilierPage from './pages/ImmobilierPage';
import CCQPage from './pages/CCQPage';

// Composants de test et validation
import FinalValidation from './components/FinalValidation';
import { AdvancedDemoControls } from './features/retirement/components/AdvancedDemoControls';

// Pages unifi√©es avec lazy loading
import UnifiedRetirementPage from './pages/UnifiedRetirementPage';

// Pages existantes (pour compatibilit√©) - Lazy loaded
const RetraiteEntreeFr = React.lazy(() => import('./pages/RetraiteEntreeFr'));
const RetraiteEntreeEn = React.lazy(() => import('./pages/RetraiteEntreeEn'));
const RetraiteModuleFr = React.lazy(() => import('./pages/RetraiteModuleFr'));
const RetraiteModuleEn = React.lazy(() => import('./pages/RetraiteModuleEn'));
const RetraiteModulePhase1Fr = React.lazy(() => import('./pages/RetraiteModulePhase1Fr'));
const RetraiteModulePhase1En = React.lazy(() => import('./pages/RetraiteModulePhase1En'));
import RapportsRetraiteFr from './pages/RapportsRetraiteFr';
import RetirementReportsEn from './pages/RetirementReportsEn';
import Phase2DemoPage from './pages/Phase2DemoPage';
import SauvegarderCharger from './pages/SauvegarderCharger';

// NOUVEAUX MODULES PHASE 3
import { FourPercentRuleModule } from './components/ui/FourPercentRuleModule';
import { OptimalAllocationModule } from './components/ui/OptimalAllocationModule';
import { ExcessLiquidityDetector } from './components/ui/ExcessLiquidityDetector';
import { InflationProtectionCenter } from './components/ui/InflationProtectionCenter';
import { BehavioralBiasEducator } from './components/ui/BehavioralBiasEducator';

function App() {
  return (
    <AuthProvider>
      <LanguageProvider>
        <Router>
          <Layout>
            <Suspense fallback={
              <div className="flex items-center justify-center min-h-screen">
                <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
              </div>
            }>
              <Routes>
              {/* üè† NOUVELLES ROUTES PRINCIPALES - Navigation restructur√©e */}
              
              {/* Page d'accueil - "VOTRE RETRAITE, VOTRE HISTOIRE" */}
              <Route path="/" element={<Accueil />} />
              <Route path="/accueil" element={<Accueil />} />
              <Route path="/fr" element={<Accueil />} />
              <Route path="/home" element={<Home />} />
              <Route path="/en" element={<Home />} />
              
              {/* Page profil - INT√âGR√âE dans Ma Retraite */}
              {/* <Route path="/mon-profil" element={<MonProfil />} /> */}
              {/* <Route path="/my-profile" element={<MyProfile />} /> */}
              
              {/* Page retraite - "TRAVAILLER AVEC CE QU'ON A" */}
              <Route path="/ma-retraite" element={<MaRetraite />} />
              <Route path="/my-retirement" element={<MaRetraite />} />
              
              {/* Page revenus - "G√âREZ VOS SOURCES DE REVENUS" */}
              <Route path="/mes-revenus" element={<Revenus />} />
              <Route path="/my-income" element={<Revenus />} />
              
              {/* Page planification d'urgence - "PROT√âGEZ VOS PROCHES" */}
              <Route path="/planification-urgence" element={<PlanificationUrgence />} />
              <Route path="/emergency-planning" element={<PlanificationUrgence />} />
              
              {/* Page planification successorale - "ORGANISEZ VOTRE SUCCESSION" */}
              <Route path="/planification-successorale" element={<PlanificationSuccessorale />} />
              <Route path="/succession-planning" element={<PlanificationSuccessorale />} />
              
              {/* Page planification de d√©penses - "OPTIMISEZ VOS ACHATS" */}
              <Route path="/planification-depenses" element={<PlanificationDepenses />} />
              <Route path="/expense-planning" element={<PlanificationDepenses />} />
              
              {/* Assistant financier personnel - "√âVITEZ LES CATASTROPHES FINANCI√àRES" */}
              <Route path="/assistant-financier" element={<AssistantFinancier />} />
              <Route path="/financial-assistant" element={<AssistantFinancier />} />
              
              {/* Module Budget - "G√âREZ VOS FINANCES INTELLIGEMMENT" */}
              <Route path="/budget" element={<Budget />} />
              <Route path="/mon-budget" element={<Budget />} />
              <Route path="/my-budget" element={<Budget />} />
              
              {/* üìä MODULE MVP HYPOTH√àSES DE CALCUL - TRANSPARENCE TOTALE */}
              
              {/* Page Hypoth√®ses de Calcul - Interface Seniors-Friendly */}
              <Route path="/hypotheses" element={<SimpleAssumptionsPage />} />
              <Route path="/hypotheses-calcul" element={<SimpleAssumptionsPage />} />
              <Route path="/assumptions" element={<SimpleAssumptionsPage />} />
              <Route path="/calculation-assumptions" element={<SimpleAssumptionsPage />} />
              
              {/* üìù NOUVELLES ROUTES - BLOG */}
              
              {/* Page principale du blog */}
              <Route path="/blog" element={<BlogPage />} />
              
              {/* Cat√©gories du blog */}
              <Route path="/blog/guides" element={<BlogPage />} />
              <Route path="/blog/conseils-experts" element={<BlogPage />} />
              <Route path="/blog/expert-tips" element={<BlogPage />} />
              <Route path="/blog/etudes-cas" element={<BlogPage />} />
              <Route path="/blog/case-studies" element={<BlogPage />} />
              <Route path="/blog/actualites-fiscales" element={<BlogPage />} />
              <Route path="/blog/tax-news" element={<BlogPage />} />
              
              {/* Articles sp√©cifiques du blog */}
              <Route path="/blog/guides/optimiser-transmission-celi" element={<OptimiserTransmissionCeli />} />
              <Route path="/blog/guides/strategies-fiscales-retraite" element={<BlogPage />} />
              <Route path="/blog/conseils-experts/10-conseils-retraite-reussie" element={<BlogPage />} />
              <Route path="/blog/conseils-experts/eviter-biais-comportementaux" element={<BlogPage />} />
              <Route path="/blog/etudes-cas/retraite-anticipee-55-ans" element={<BlogPage />} />
              <Route path="/blog/etudes-cas/optimisation-successorale-4-enfants" element={<BlogPage />} />
              <Route path="/blog/actualites-fiscales/budget-2024-retraites" element={<BlogPage />} />
              <Route path="/blog/actualites-fiscales/nouvelles-regles-ferr-2024" element={<BlogPage />} />
              
              {/* Articles populaires */}
              <Route path="/blog/guides/reer-vs-celi-optimization" element={<BlogPage />} />
              <Route path="/blog/conseils-experts/5-erreurs-couteuses-retraite" element={<BlogPage />} />
              <Route path="/blog/actualites-fiscales/impact-inflation-retraite" element={<BlogPage />} />
              
              {/* üèõÔ∏è NOUVELLES ROUTES - PRESTATIONS GOUVERNEMENTALES */}
              
              {/* Module SRG (Suppl√©ment de Revenu Garanti) */}
              <Route path="/module-srg" element={<div className="p-8"><SRGAnalysisSection data={{} as any} onUpdate={() => {}} /></div>} />
              <Route path="/srg-module" element={<div className="p-8"><SRGAnalysisSection data={{} as any} onUpdate={() => {}} /></div>} />
              
              {/* Module RREGOP (R√©gime de Retraite Gouvernemental) */}
              <Route path="/module-rregop" element={<RREGOPAnalysisSection userPlan="professional" />} />
              <Route path="/rregop-module" element={<RREGOPAnalysisSection userPlan="professional" />} />
              
              {/* Module RRQ/CPP */}
              <Route path="/rrq-cpp-analysis" element={<RRQCPPAnalysis />} />
              <Route path="/analyse-rrq-cpp" element={<RRQCPPAnalysis />} />
              
              {/* Module CCQ - Commission de la Construction du Qu√©bec */}
              <Route path="/module-ccq" element={<CCQPage />} />
              <Route path="/ccq-module" element={<CCQPage />} />
              
              {/* Module OAS/GIS */}
              <Route path="/oas-gis-analysis" element={<div className="p-8 text-center"><h1 className="text-2xl font-bold text-gray-800">Analyse OAS/GIS</h1><p className="text-gray-600 mt-4">Module en d√©veloppement</p></div>} />
              <Route path="/analyse-oas-gis" element={<div className="p-8 text-center"><h1 className="text-2xl font-bold text-gray-800">Analyse OAS/GIS</h1><p className="text-gray-600 mt-4">Module en d√©veloppement</p></div>} />
              
              {/* üè† NOUVELLES ROUTES - OPTIMISATION IMMOBILI√àRE */}
              
              {/* Module Immobilier */}
              <Route path="/optimisation-immobiliere" element={<RealEstateOptimizationSection userPlan="professional" />} />
              <Route path="/real-estate-optimization" element={<RealEstateOptimizationSection userPlan="professional" />} />
              
              {/* Page Immobilier - Gestion compl√®te du patrimoine immobilier */}
              <Route path="/immobilier" element={<ImmobilierPage />} />
              <Route path="/real-estate" element={<ImmobilierPage />} />
              
              {/* üìä NOUVELLES ROUTES - SIMULATIONS */}
              
              {/* Simulateur Monte Carlo */}
              <Route path="/simulateur-monte-carlo" element={<MonteCarloSimulator />} />
              <Route path="/monte-carlo-simulator" element={<MonteCarloSimulator />} />
              
              {/* Analyse de Sensibilit√© */}
              <Route path="/analyse-sensibilite" element={<SensitivityAnalysis />} />
              <Route path="/sensitivity-analysis" element={<SensitivityAnalysis />} />
              
              {/* Comparaison de Sc√©narios */}
              <Route path="/comparaison-scenarios" element={<ScenarioComparison />} />
              <Route path="/scenario-comparison" element={<ScenarioComparison />} />
              
              {/* üéØ NOUVELLES ROUTES - OPTIMISATION FISCALE ET PLANIFICATION */}
              
              {/* Optimisation Fiscale */}
              <Route path="/optimisation-fiscale" element={<TaxOptimizationDashboard />} />
              <Route path="/tax-optimization" element={<TaxOptimizationDashboard />} />
              
                      {/* Planification Expert */}
        <Route path="/planification-expert" element={<UltimatePlanningDashboard />} />
        <Route path="/expert-planning" element={<UltimatePlanningDashboard />} />
        
        {/* Module de D√©penses */}
        <Route path="/depenses" element={<ExpensesPage />} />
        <Route path="/expenses" element={<ExpensesPage />} />
        
        {/* üöÄ NOUVEAUX MODULES PHASE 1, 2 ET 3 */}
        
        {/* Phase 1 - Modules Essentiels */}
        <Route path="/module-celi-succession" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Module Succession C√âLI</h1>
              <p className="text-gray-600 mb-8">Optimisez la transmission de votre C√âLI selon les conseils d'experts.</p>
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-blue-900 mb-4">Points Cl√©s:</h2>
                <ul className="space-y-2 text-blue-800">
                  <li>‚Ä¢ Nommez un titulaire successeur pour √©viter les taxes</li>
                  <li>‚Ä¢ √âvitez les erreurs co√ªteuses de d√©signation</li>
                  <li>‚Ä¢ Maximisez la transmission tax-free</li>
                  <li>‚Ä¢ Prot√©gez contre les frais d'homologation</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        <Route path="/calculateur-impact-fiscal-65" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Calculateur Impact Fiscal √† 65 ans</h1>
              <p className="text-gray-600 mb-8">D√©couvrez les √©conomies fiscales automatiques √† 65 ans.</p>
              <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-green-900 mb-4">√âconomies Potentielles:</h2>
                <ul className="space-y-2 text-green-800">
                  <li>‚Ä¢ Cr√©dit d'√¢ge f√©d√©ral et provincial</li>
                  <li>‚Ä¢ Cr√©dit pour revenu de pension (2000$ premiers)</li>
                  <li>‚Ä¢ Fractionnement du revenu de pension</li>
                  <li>‚Ä¢ R√©duction d'imp√¥t de 1600$+ par ann√©e</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        <Route path="/tableau-bord-10-conseils" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Tableau de Bord - 10 Conseils Essentiels</h1>
              <p className="text-gray-600 mb-8">Suivez votre progression sur les 10 conseils cruciaux pour la retraite.</p>
              <div className="bg-orange-50 border border-orange-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-orange-900 mb-4">Conseils Int√©gr√©s:</h2>
                <ul className="space-y-2 text-orange-800">
                  <li>‚Ä¢ Conna√Ætre ses d√©penses mensuelles</li>
                  <li>‚Ä¢ √ätre libre de dettes</li>
                  <li>‚Ä¢ Consolider ses actifs</li>
                  <li>‚Ä¢ Automatiser les retraits</li>
                  <li>‚Ä¢ Et 6 autres conseils essentiels</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        {/* Phase 2 - Optimisation Avanc√©e */}
        <Route path="/module-consolidation-actifs" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Module Consolidation d'Actifs</h1>
              <p className="text-gray-600 mb-8">Simplifiez et optimisez la gestion de vos placements.</p>
              <div className="bg-purple-50 border border-purple-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-purple-900 mb-4">Avantages:</h2>
                <ul className="space-y-2 text-purple-800">
                  <li>‚Ä¢ R√©duction des frais de gestion</li>
                  <li>‚Ä¢ Simplification administrative</li>
                  <li>‚Ä¢ Meilleur suivi de performance</li>
                  <li>‚Ä¢ √âconomies de 0.5-2% par ann√©e</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        <Route path="/module-coussin-liquidites" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Module Coussin de Liquidit√©s</h1>
              <p className="text-gray-600 mb-8">G√©rez la volatilit√© avec la strat√©gie bucket.</p>
              <div className="bg-cyan-50 border border-cyan-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-cyan-900 mb-4">Strat√©gie Bucket:</h2>
                <ul className="space-y-2 text-cyan-800">
                  <li>‚Ä¢ 3-5 ans de liquidit√©s prot√©g√©es</li>
                  <li>‚Ä¢ √âviter de vendre en baisse de march√©</li>
                  <li>‚Ä¢ Maintenir le style de vie d√©sir√©</li>
                  <li>‚Ä¢ R√©duire le stress financier</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        <Route path="/centre-education-fiscale" element={
          <div className="p-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-3xl font-bold text-gray-900 mb-6">Centre d'√âducation Fiscale</h1>
              <p className="text-gray-600 mb-8">Ma√Ætrisez les strat√©gies fiscales pour la retraite.</p>
              <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                <h2 className="text-xl font-semibold text-indigo-900 mb-4">Sujets Couverts:</h2>
                <ul className="space-y-2 text-indigo-800">
                  <li>‚Ä¢ Fractionnement du revenu</li>
                  <li>‚Ä¢ Optimisation des retraits</li>
                  <li>‚Ä¢ Cr√©dits d'imp√¥t disponibles</li>
                  <li>‚Ä¢ Planification successorale fiscale</li>
                </ul>
              </div>
            </div>
          </div>
        } />
        
        {/* Phase 3 - Optimisation Experte */}
        <Route path="/module-regle-4-pourcent" element={
          <div className="p-8">
            <FourPercentRuleModule />
          </div>
        } />
        
        <Route path="/module-allocation-optimale" element={
          <div className="p-8">
            <OptimalAllocationModule userPlan="professional" />
          </div>
        } />
        
        <Route path="/detecteur-liquidites-excessives" element={
          <div className="p-8">
            <ExcessLiquidityDetector userPlan="professional" />
          </div>
        } />
        
        <Route path="/centre-protection-inflation" element={
          <div className="p-8">
            <InflationProtectionCenter userPlan="professional" />
          </div>
        } />
        
        <Route path="/educateur-biais-comportementaux" element={
          <div className="p-8">
            <BehavioralBiasEducator userPlan="professional" />
          </div>
        } />
              
              {/* üß™ ROUTES DE TEST ET VALIDATION */}
              
              {/* Test des contr√¥les de d√©monstration avanc√©s */}
              <Route path="/advanced-demo-controls" element={<AdvancedDemoControls />} />
              
              
              {/* Validation finale - Derni√®re √©tape avant d√©ploiement */}
              <Route path="/validation-finale" element={<FinalValidation />} />
              
              {/* üåê ROUTES BILINGUES EXISTANTES (pour compatibilit√©) */}
              
              {/* Routes d'entr√©e - Module Retirement */}
              <Route path="/fr/retraite-entree" element={<RetraiteEntreeFr />} />
              <Route path="/en/retirement-entry" element={<RetraiteEntreeEn />} />
              
              {/* Routes du module complet - Module Retirement UNIFI√âES */}
              <Route path="/fr/retraite" element={<UnifiedRetirementPage />} />
              <Route path="/en/retirement" element={<UnifiedRetirementPage />} />
              
              <Route path="/fr/retraite-module" element={<RetraiteModuleFr />} />
              <Route path="/en/retirement-module" element={<RetraiteModuleEn />} />
              
              {/* Routes pour le module retraite Phase 1 */}
              <Route path="/fr/retraite-module-phase1" element={<RetraiteModulePhase1Fr />} />
              <Route path="/en/retirement-module-phase1" element={<RetraiteModulePhase1En />} />
              
              {/* Routes Rapports de Retraite */}
              <Route path="/fr/rapports-retraite" element={<RapportsRetraiteFr />} />
              <Route path="/en/retirement-reports" element={<RetirementReportsEn />} />
              
              {/* Route Phase 2 Demo */}
              <Route path="/phase2-demo" element={<Phase2DemoPage />} />
              
              {/* Routes Sauvegarder/Charger */}
              <Route path="/fr/sauvegarder-charger" element={<SauvegarderCharger />} />
              <Route path="/en/save-load" element={<SauvegarderCharger />} />
              
              {/* Route Admin */}
              <Route path="/admin" element={<div className="p-8 text-center"><h1 className="text-2xl font-bold text-gray-800">Admin Panel</h1><p className="text-gray-600 mt-4">Administration panel - Coming soon</p></div>} />
              
              {/* üîÑ REDIRECTIONS INTELLIGENTES */}
              
              {/* Redirection des anciennes routes vers la nouvelle structure */}
              <Route path="/fr" element={<Accueil />} />
              <Route path="/en" element={<Accueil />} />
              
              {/* Redirection par d√©faut vers la nouvelle page d'accueil */}
              <Route path="*" element={<Accueil />} />
              </Routes>
            </Suspense>
          </Layout>
        </Router>
      </LanguageProvider>
    </AuthProvider>
  );
}

export default App;
